{"version":3,"sources":["../../../../src/lib/file-upload.ts","../../../../src/app/actions/banners.ts","../../../../.next-internal/server/app/admin/banners/new/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["import { writeFile, mkdir } from \"fs/promises\";\r\nimport { join } from \"path\";\r\n\r\n/**\r\n * Salva um arquivo na pasta public/uploads/{folder}\r\n * @param file O arquivo vindo do formulário\r\n * @param folder O nome da subpasta (ex: 'news', 'team', 'banners')\r\n * @returns A URL pública para acessar a imagem (ex: /uploads/news/foto.jpg)\r\n */\r\nexport async function saveFile(file: File | null, folder: string = \"general\"): Promise<string> {\r\n  if (!file || typeof file !== \"object\" || !file.size) return \"\";\r\n\r\n  try {\r\n    const bytes = await file.arrayBuffer();\r\n    const buffer = Buffer.from(bytes);\r\n\r\n    // Limpa o nome do arquivo para evitar caracteres estranhos\r\n    const safeName = file.name.replace(/[^a-zA-Z0-9.-]/g, \"_\");\r\n    // Cria um nome único: TIMESTAMP-NOME\r\n    const filename = `${Date.now()}-${safeName}`;\r\n\r\n    // Define o caminho no servidor: ./public/uploads/pasta\r\n    const uploadDir = join(process.cwd(), \"public\", \"uploads\", folder);\r\n    \r\n    // Cria a pasta se ela não existir\r\n    await mkdir(uploadDir, { recursive: true });\r\n\r\n    // Caminho completo do arquivo\r\n    const finalPath = join(uploadDir, filename);\r\n\r\n    // Grava o arquivo no disco\r\n    await writeFile(finalPath, buffer);\r\n\r\n    // Retorna o caminho público (URL)\r\n    return `/uploads/${folder}/${filename}`;\r\n  } catch (error) {\r\n    console.error(`Erro ao salvar arquivo em ${folder}:`, error);\r\n    return \"\";\r\n  }\r\n}","\"use server\"\r\n\r\nimport { prisma } from \"@/lib/prisma\"\r\nimport { revalidatePath } from \"next/cache\"\r\nimport { saveFile } from \"@/lib/file-upload\"\r\nimport { unlink } from \"fs/promises\"\r\nimport { join } from \"path\"\r\nimport { existsSync } from \"fs\"\r\n\r\ntype BannerType = \"HOME\" | \"PARTNER\" | \"SPONSOR\";\r\n\r\n// HELPER: Pega o ID não importa se veio Texto ou FormData\r\nfunction getId(data: string | FormData): string {\r\n  if (typeof data === 'string') return data\r\n  return data.get(\"id\") as string\r\n}\r\n\r\n// --- CREATE ---\r\nexport async function createBanner(formData: FormData) {\r\n  try {\r\n    const title = formData.get(\"title\") as string\r\n    const description = formData.get(\"description\") as string\r\n    const link = formData.get(\"link\") as string\r\n    const type = formData.get(\"type\") as BannerType\r\n    const order = parseInt(formData.get(\"order\") as string) || 0\r\n    const active = formData.get(\"active\") === \"on\"\r\n    \r\n    const file = formData.get(\"image\") as File\r\n    const imageUrl = await saveFile(file, \"banners\")\r\n\r\n    if (!imageUrl) return { error: \"A imagem do banner é obrigatória.\" }\r\n\r\n    await prisma.banner.create({\r\n      data: {\r\n        title,\r\n        description,\r\n        link,\r\n        imageUrl,\r\n        order,\r\n        active,\r\n        type: type || \"HOME\"\r\n      }\r\n    })\r\n\r\n    revalidatePath(\"/\")\r\n    revalidatePath(\"/parceiros\")\r\n    revalidatePath(\"/admin/banners\")\r\n    return { success: true }\r\n\r\n  } catch (error) {\r\n    console.error(\"Erro ao criar banner:\", error)\r\n    return { error: \"Erro ao salvar banner.\" }\r\n  }\r\n}\r\n\r\n// --- UPDATE ---\r\nexport async function updateBanner(formData: FormData) {\r\n  try {\r\n    const id = formData.get(\"id\") as string\r\n    if (!id) return { error: \"ID não encontrado.\" }\r\n\r\n    const title = formData.get(\"title\") as string\r\n    const description = formData.get(\"description\") as string\r\n    const link = formData.get(\"link\") as string\r\n    const type = formData.get(\"type\") as BannerType\r\n    const order = parseInt(formData.get(\"order\") as string) || 0\r\n    const active = formData.get(\"active\") === \"on\"\r\n    \r\n    const file = formData.get(\"image\") as File\r\n    let imageUrl = formData.get(\"existingImageUrl\") as string\r\n\r\n    if (file && file.size > 0) {\r\n        imageUrl = await saveFile(file, \"banners\")\r\n    }\r\n\r\n    await prisma.banner.update({\r\n      where: { id },\r\n      data: {\r\n        title,\r\n        description,\r\n        link,\r\n        imageUrl,\r\n        order,\r\n        active,\r\n        type\r\n      }\r\n    })\r\n\r\n    revalidatePath(\"/\")\r\n    revalidatePath(\"/parceiros\")\r\n    revalidatePath(\"/admin/banners\")\r\n    return { success: true }\r\n\r\n  } catch (error) {\r\n    console.error(\"Erro ao atualizar banner:\", error)\r\n    return { error: \"Erro ao atualizar.\" }\r\n  }\r\n}\r\n\r\n// --- DELETE (CORRIGIDO / HÍBRIDO) ---\r\n// Aceita 'data' sendo STRING (do .bind) ou FORMDATA (do botão DeleteButton)\r\nexport async function deleteBanner(data: string | FormData) {\r\n  const id = getId(data)\r\n  if (!id) return\r\n\r\n  try {\r\n    const banner = await prisma.banner.findUnique({ where: { id } })\r\n    if (banner?.imageUrl) {\r\n        try {\r\n            const filePath = join(process.cwd(), \"public\", banner.imageUrl)\r\n            if (existsSync(filePath)) await unlink(filePath)\r\n        } catch (e) {}\r\n    }\r\n\r\n    await prisma.banner.delete({ where: { id } })\r\n    \r\n    revalidatePath(\"/admin/banners\")\r\n    revalidatePath(\"/\")\r\n  } catch (error) {\r\n    console.error(\"Erro ao excluir banner:\", error)\r\n  }\r\n}\r\n\r\n// --- TOGGLE ACTIVE ---\r\nexport async function toggleBannerActive(id: string, currentState: boolean) {\r\n    if (!id) return\r\n  \r\n    try {\r\n      await prisma.banner.update({\r\n        where: { id },\r\n        data: { active: !currentState }\r\n      })\r\n        \r\n      revalidatePath(\"/admin/banners\")\r\n      revalidatePath(\"/\")\r\n      \r\n    } catch (error) {\r\n      console.error(\"Erro ao alternar banner:\", error)\r\n    }\r\n}","export {updateBanner as '407a83ab8d9fc81907190df3845e351e8b9cab2b7f'} from 'ACTIONS_MODULE0'\nexport {createBanner as '408798389a74036830df79f798babcba1913186541'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":"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"}