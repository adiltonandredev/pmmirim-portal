{"version":3,"sources":["../../../../src/lib/file-upload.ts","../../../../src/app/actions/upload.ts","../../../../src/app/actions/courses.ts","../../../../.next-internal/server/app/admin/courses/new/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["import { writeFile, mkdir } from \"fs/promises\";\r\nimport { join } from \"path\";\r\n\r\n/**\r\n * Salva um arquivo na pasta public/uploads/{folder}\r\n * @param file O arquivo vindo do formulário\r\n * @param folder O nome da subpasta (ex: 'news', 'team', 'banners')\r\n * @returns A URL pública para acessar a imagem (ex: /uploads/news/foto.jpg)\r\n */\r\nexport async function saveFile(file: File | null, folder: string = \"general\"): Promise<string> {\r\n  if (!file || typeof file !== \"object\" || !file.size) return \"\";\r\n\r\n  try {\r\n    const bytes = await file.arrayBuffer();\r\n    const buffer = Buffer.from(bytes);\r\n\r\n    // Limpa o nome do arquivo para evitar caracteres estranhos\r\n    const safeName = file.name.replace(/[^a-zA-Z0-9.-]/g, \"_\");\r\n    // Cria um nome único: TIMESTAMP-NOME\r\n    const filename = `${Date.now()}-${safeName}`;\r\n\r\n    // Define o caminho no servidor: ./public/uploads/pasta\r\n    const uploadDir = join(process.cwd(), \"public\", \"uploads\", folder);\r\n    \r\n    // Cria a pasta se ela não existir\r\n    await mkdir(uploadDir, { recursive: true });\r\n\r\n    // Caminho completo do arquivo\r\n    const finalPath = join(uploadDir, filename);\r\n\r\n    // Grava o arquivo no disco\r\n    await writeFile(finalPath, buffer);\r\n\r\n    // Retorna o caminho público (URL)\r\n    return `/uploads/${folder}/${filename}`;\r\n  } catch (error) {\r\n    console.error(`Erro ao salvar arquivo em ${folder}:`, error);\r\n    return \"\";\r\n  }\r\n}","'use server'\r\n\r\nimport { writeFile, mkdir } from 'fs/promises'\r\nimport { join } from 'path'\r\n\r\nexport async function uploadImage(formData: FormData) {\r\n  const file = formData.get('file') as File\r\n  \r\n  if (!file) {\r\n    throw new Error('Nenhum arquivo enviado')\r\n  }\r\n\r\n  const bytes = await file.arrayBuffer()\r\n  const buffer = Buffer.from(bytes)\r\n\r\n  // Cria um nome único para o arquivo para não substituir outros\r\n  const filename = `${Date.now()}-${file.name.replace(/\\s/g, '-')}`\r\n  \r\n  // Caminho onde será salvo (dentro de public/uploads)\r\n  const uploadDir = join(process.cwd(), 'public', 'uploads')\r\n  \r\n  // Garante que a pasta existe\r\n  try {\r\n    await mkdir(uploadDir, { recursive: true })\r\n  } catch (e) {\r\n    // Ignora erro se a pasta já existir\r\n  }\r\n\r\n  const path = join(uploadDir, filename)\r\n\r\n  // Salva o arquivo no disco\r\n  await writeFile(path, buffer)\r\n\r\n  // Retorna a URL pública para o editor usar\r\n  return `/uploads/${filename}`\r\n}","\"use server\"\r\n\r\nimport { prisma } from \"@/lib/prisma\"\r\nimport { revalidatePath } from \"next/cache\"\r\nimport { saveFile } from \"@/lib/file-upload\"\r\n\r\n// 1. CRIAR CURSO\r\nexport async function createCourse(formData: FormData) {\r\n  try {\r\n    const data = {\r\n      title: formData.get(\"title\") as string,\r\n      description: formData.get(\"description\") as string,\r\n      content: formData.get(\"content\") as string,\r\n      duration: formData.get(\"duration\") as string,\r\n      targetAge: formData.get(\"targetAge\") as string,\r\n      sponsorName: formData.get(\"sponsorName\") as string,\r\n      active: formData.get(\"active\") === \"on\",\r\n    }\r\n\r\n    // SALVA NA PASTA \"courses\"\r\n    const coverFile = formData.get(\"coverImage\") as File\r\n    const coverImage = await saveFile(coverFile, \"courses\")\r\n\r\n    const sponsorFile = formData.get(\"sponsorLogo\") as File\r\n    const sponsorLogo = await saveFile(sponsorFile, \"courses\")\r\n\r\n    // Gera o slug automaticamente\r\n    const slug = data.title\r\n      .toLowerCase()\r\n      .normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\")\r\n      .replace(/[^a-z0-9]+/g, \"-\")\r\n      .replace(/^-+|-+$/g, \"\") + \"-\" + Date.now().toString().slice(-4);\r\n\r\n    await prisma.course.create({\r\n      data: {\r\n        ...data,\r\n        slug,\r\n        coverImage,\r\n        sponsorLogo,\r\n        featured: false,\r\n      },\r\n    })\r\n\r\n    revalidatePath(\"/admin/courses\")\r\n    revalidatePath(\"/cursos\")\r\n    return { success: true }\r\n  } catch (error) {\r\n    console.error(\"Error creating course:\", error)\r\n    return { error: \"Erro ao salvar curso.\" }\r\n  }\r\n}\r\n\r\n// 2. ATUALIZAR CURSO\r\nexport async function updateCourse(formData: FormData) {\r\n  try {\r\n    const id = formData.get(\"id\") as string\r\n    \r\n    // Atualiza Capa\r\n    const coverFile = formData.get(\"coverImage\") as File\r\n    let coverImage = formData.get(\"existingCoverImage\") as string\r\n    if (coverFile && coverFile.size > 0) {\r\n        coverImage = await saveFile(coverFile, \"courses\")\r\n    }\r\n\r\n    // Atualiza Logo Patrocinador\r\n    const sponsorFile = formData.get(\"sponsorLogo\") as File\r\n    let sponsorLogo = formData.get(\"existingSponsorLogo\") as string\r\n    if (sponsorFile && sponsorFile.size > 0) {\r\n        sponsorLogo = await saveFile(sponsorFile, \"courses\")\r\n    }\r\n\r\n    const data = {\r\n      title: formData.get(\"title\") as string,\r\n      description: formData.get(\"description\") as string,\r\n      content: formData.get(\"content\") as string,\r\n      duration: formData.get(\"duration\") as string,\r\n      targetAge: formData.get(\"targetAge\") as string,\r\n      sponsorName: formData.get(\"sponsorName\") as string,\r\n      active: formData.get(\"active\") === \"on\",\r\n      coverImage,\r\n      sponsorLogo,\r\n    }\r\n\r\n    await prisma.course.update({ where: { id }, data })\r\n\r\n    revalidatePath(\"/admin/courses\")\r\n    revalidatePath(\"/cursos\")\r\n    return { success: true }\r\n  } catch (error) {\r\n    console.error(\"Error updating course:\", error)\r\n    return { error: \"Erro ao atualizar curso.\" }\r\n  }\r\n}\r\n\r\n// 3. EXCLUIR CURSO\r\nexport async function deleteCourse(formData: FormData) {\r\n  const id = formData.get(\"id\") as string\r\n  if (!id) return\r\n\r\n  try {\r\n    await prisma.course.delete({ where: { id } })\r\n    revalidatePath(\"/admin/courses\")\r\n    revalidatePath(\"/cursos\")\r\n  } catch (error) {\r\n    console.error(\"Erro ao excluir curso:\", error)\r\n  }\r\n}","export {createCourse as '4064bb6951be399a71e6c49788a76238e850e42e8a'} from 'ACTIONS_MODULE0'\nexport {updateCourse as '408e9b187562794d6da5e7f8f3f516c03380d786e2'} from 'ACTIONS_MODULE0'\nexport {uploadImage as '401628db911d95f41b15dc4a76335400ed4d4ce6ea'} from 'ACTIONS_MODULE1'\n"],"names":[],"mappings":"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"}