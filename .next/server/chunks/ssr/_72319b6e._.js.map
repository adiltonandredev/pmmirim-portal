{"version":3,"sources":["../../../../src/app/actions/students.ts","../../../../.next-internal/server/app/admin/featured-student/new/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["\"use server\"\r\n\r\nimport { prisma } from \"@/lib/prisma\"\r\nimport { revalidatePath } from \"next/cache\"\r\n\r\ntype ActionData = FormData | Record<string, unknown>;\r\n\r\nfunction getValue(data: ActionData, key: string): unknown {\r\n  if (data instanceof FormData) return data.get(key);\r\n  return data[key];\r\n}\r\n\r\n// === PROCESSAMENTO DE IMAGEM ROBUSTO (Igual ao Aniversariantes) ===\r\nasync function processImage(photoInput: unknown, existingUrl?: string): Promise<string> {\r\n  if (\r\n    photoInput &&\r\n    typeof photoInput === 'object' &&\r\n    photoInput !== null &&\r\n    'size' in photoInput &&\r\n    'arrayBuffer' in photoInput &&\r\n    (photoInput as any).size > 0\r\n  ) {\r\n    try {\r\n      const file = photoInput as File;\r\n      const buffer = await file.arrayBuffer();\r\n      const base64 = Buffer.from(buffer).toString('base64');\r\n      const mimeType = file.type || 'image/jpeg';\r\n      return `data:${mimeType};base64,${base64}`;\r\n    } catch (e) {\r\n      console.error(\"Erro imagem aluno:\", e);\r\n      return existingUrl || \"\";\r\n    }\r\n  }\r\n  return existingUrl || \"\";\r\n}\r\n\r\n// === ACTIONS ===\r\n\r\nexport async function createFeaturedStudent(data: ActionData) {\r\n  try {\r\n    const studentName = getValue(data, \"studentName\") as string;\r\n    const achievement = getValue(data, \"achievement\") as string;\r\n    const turma = getValue(data, \"class\") as string;\r\n    const description = getValue(data, \"description\") as string;\r\n    const month = Number(getValue(data, \"month\"));\r\n    const year = Number(getValue(data, \"year\"));\r\n\r\n    const photoInput = getValue(data, \"photoUrl\");\r\n    const photoUrl = await processImage(photoInput);\r\n\r\n    if (!studentName) throw new Error(\"Nome é obrigatório.\");\r\n\r\n    await prisma.featuredStudent.create({\r\n      data: {\r\n        studentName,\r\n        achievement: achievement || \"Destaque do Mês\",\r\n        class: turma || \"\",\r\n        description: description || \"\",\r\n        month: month || new Date().getMonth() + 1,\r\n        year: year || new Date().getFullYear(),\r\n        photoUrl,\r\n        active: true,\r\n      },\r\n    })\r\n\r\n    revalidatePath(\"/admin/featured-student\")\r\n    revalidatePath(\"/\")\r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error(\"ERRO CRIAR ALUNO:\", error);\r\n    throw error;\r\n  }\r\n}\r\n\r\nexport async function updateFeaturedStudent(data: ActionData) {\r\n  try {\r\n    const id = getValue(data, \"id\") as string;\r\n    const finalId = id || (data instanceof FormData ? data.get(\"id\") as string : null);\r\n\r\n    if (!finalId) throw new Error(\"ID não encontrado.\");\r\n\r\n    const studentName = getValue(data, \"studentName\") as string;\r\n    const achievement = getValue(data, \"achievement\") as string;\r\n    const turma = getValue(data, \"class\") as string;\r\n    const description = getValue(data, \"description\") as string;\r\n    const month = Number(getValue(data, \"month\"));\r\n    const year = Number(getValue(data, \"year\"));\r\n\r\n    const photoInput = getValue(data, \"photoUrl\");\r\n    const existingPhotoUrl = getValue(data, \"existingPhotoUrl\") as string;\r\n    const photoUrl = await processImage(photoInput, existingPhotoUrl);\r\n\r\n    const activeRaw = getValue(data, \"active\");\r\n    const active = activeRaw === \"on\" || activeRaw === true;\r\n\r\n    await prisma.featuredStudent.update({\r\n      where: { id: finalId },\r\n      data: {\r\n        studentName,\r\n        achievement,\r\n        class: turma,\r\n        description,\r\n        month,\r\n        year,\r\n        photoUrl,\r\n        active,\r\n      },\r\n    })\r\n\r\n    revalidatePath(\"/admin/featured-student\")\r\n    revalidatePath(\"/\")\r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error(\"ERRO ATUALIZAR ALUNO:\", error);\r\n    throw error;\r\n  }\r\n}\r\n\r\nexport async function deleteFeaturedStudent(formData: FormData) {\r\n  // Pegando o ID direto e reto\r\n  const id = formData.get(\"id\") as string;\r\n  \r\n  if (!id) return;\r\n\r\n  try {\r\n    await prisma.featuredStudent.delete({\r\n      where: { id }\r\n    });\r\n    \r\n    revalidatePath(\"/admin/featured-student\");\r\n    revalidatePath(\"/\");\r\n    \r\n    // Sem retorno (void) para agradar o formulário\r\n  } catch (error) {\r\n    console.error(\"Erro ao deletar:\", error);\r\n  }\r\n}","export {createFeaturedStudent as '405faf590e8a13cf7156ec36a38743faf0f0af3a13'} from 'ACTIONS_MODULE0'\nexport {updateFeaturedStudent as '407083e883aa7b162a537c5369da69858dea5ff92a'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":"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"}