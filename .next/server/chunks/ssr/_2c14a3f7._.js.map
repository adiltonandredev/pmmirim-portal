{"version":3,"sources":["../../../../src/app/actions/users.ts","../../../../.next-internal/server/app/admin/users/new/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["\"use server\"\r\n\r\nimport { prisma } from \"@/lib/prisma\"\r\nimport { auth } from \"@/auth\"\r\nimport { revalidatePath } from \"next/cache\"\r\nimport { hash } from \"bcryptjs\"\r\n\r\n// 1. CRIAR USUÁRIO\r\nexport async function createUser(formData: FormData) {\r\n  const name = formData.get(\"name\") as string\r\n  const email = formData.get(\"email\") as string\r\n  \r\n  // Pega o cargo ou define padrão\r\n  const roleRaw = formData.get(\"role\") as string\r\n  const role = (roleRaw === \"ADMIN\" || roleRaw === \"USER\") ? roleRaw : \"USER\"\r\n\r\n  const password = formData.get(\"password\") as string\r\n  const confirmPassword = formData.get(\"confirmPassword\") as string\r\n\r\n  const session = await auth()\r\n  if (!session || session.user.role !== \"ADMIN\") return { error: \"Sem permissão.\" }\r\n\r\n  // Validação: Senhas iguais?\r\n  if (password !== confirmPassword) {\r\n      return { error: \"A confirmação de senha não confere.\" }\r\n  }\r\n\r\n  const existing = await prisma.user.findUnique({ where: { email } })\r\n  if (existing) return { error: \"Email já cadastrado.\" }\r\n\r\n  const hashedPassword = await hash(password, 10)\r\n\r\n  await prisma.user.create({\r\n    data: { \r\n        name, \r\n        email, \r\n        password: hashedPassword, \r\n        // O truque 'as any' remove o erro vermelho do TypeScript\r\n        role: role as any \r\n    },\r\n  })\r\n\r\n  revalidatePath(\"/admin/users\")\r\n  return { success: \"Criado com sucesso!\" }\r\n}\r\n\r\n// 2. ATUALIZAR USUÁRIO\r\nexport async function updateUser(formData: FormData) {\r\n  const id = formData.get(\"id\") as string\r\n  const name = formData.get(\"name\") as string\r\n  const email = formData.get(\"email\") as string\r\n  \r\n  const roleRaw = formData.get(\"role\") as string\r\n  const role = (roleRaw === \"ADMIN\" || roleRaw === \"USER\") ? roleRaw : \"USER\"\r\n\r\n  const password = formData.get(\"password\") as string\r\n  const confirmPassword = formData.get(\"confirmPassword\") as string\r\n\r\n  const session = await auth()\r\n  if (!session || session.user.role !== \"ADMIN\") return { error: \"Não autorizado\" }\r\n\r\n  // Prepara os dados. Usamos 'as any' no role para evitar erro de tipo.\r\n  const dataToUpdate: any = { name, email, role: role as any }\r\n\r\n  // Só troca senha se digitou algo\r\n  if (password && password.trim() !== \"\") {\r\n      if (password !== confirmPassword) return { error: \"As senhas não conferem!\" }\r\n      dataToUpdate.password = await hash(password, 10)\r\n  }\r\n\r\n  try {\r\n      await prisma.user.update({ where: { id }, data: dataToUpdate })\r\n      revalidatePath(\"/admin/users\")\r\n      return { success: \"Atualizado!\" }\r\n  } catch (error) {\r\n      return { error: \"Erro ao atualizar.\" }\r\n  }\r\n}\r\n\r\n// 3. EXCLUIR USUÁRIO\r\nexport async function deleteUser(formData: FormData) {\r\n  const userId = formData.get(\"id\") as string\r\n  const session = await auth()\r\n  \r\n  if (!session || session.user.role !== \"ADMIN\") return \r\n  if (session.user.id === userId) return \r\n\r\n  try {\r\n    await prisma.user.delete({ where: { id: userId } })\r\n    revalidatePath(\"/admin/users\")\r\n  } catch (error) {\r\n    console.error(\"Erro ao excluir:\", error)\r\n  }\r\n}","export {createUser as '403aef4243634b236429ba8d48a4dcc226948f93d5'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":"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"}