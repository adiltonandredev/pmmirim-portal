{"version":3,"sources":["../../../../src/lib/file-upload.ts","../../../../src/app/actions/team.ts","../../../../.next-internal/server/app/admin/institution/team/new/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["import { writeFile, mkdir } from \"fs/promises\";\r\nimport { join } from \"path\";\r\n\r\n/**\r\n * Salva um arquivo na pasta public/uploads/{folder}\r\n * @param file O arquivo vindo do formulário\r\n * @param folder O nome da subpasta (ex: 'news', 'team', 'banners')\r\n * @returns A URL pública para acessar a imagem (ex: /uploads/news/foto.jpg)\r\n */\r\nexport async function saveFile(file: File | null, folder: string = \"general\"): Promise<string> {\r\n  if (!file || typeof file !== \"object\" || !file.size) return \"\";\r\n\r\n  try {\r\n    const bytes = await file.arrayBuffer();\r\n    const buffer = Buffer.from(bytes);\r\n\r\n    // Limpa o nome do arquivo para evitar caracteres estranhos\r\n    const safeName = file.name.replace(/[^a-zA-Z0-9.-]/g, \"_\");\r\n    // Cria um nome único: TIMESTAMP-NOME\r\n    const filename = `${Date.now()}-${safeName}`;\r\n\r\n    // Define o caminho no servidor: ./public/uploads/pasta\r\n    const uploadDir = join(process.cwd(), \"public\", \"uploads\", folder);\r\n    \r\n    // Cria a pasta se ela não existir\r\n    await mkdir(uploadDir, { recursive: true });\r\n\r\n    // Caminho completo do arquivo\r\n    const finalPath = join(uploadDir, filename);\r\n\r\n    // Grava o arquivo no disco\r\n    await writeFile(finalPath, buffer);\r\n\r\n    // Retorna o caminho público (URL)\r\n    return `/uploads/${folder}/${filename}`;\r\n  } catch (error) {\r\n    console.error(`Erro ao salvar arquivo em ${folder}:`, error);\r\n    return \"\";\r\n  }\r\n}","\"use server\"\r\n\r\nimport { prisma } from \"@/lib/prisma\"\r\nimport { revalidatePath } from \"next/cache\"\r\nimport { saveFile } from \"@/lib/file-upload\"\r\n\r\n// 1. CRIAR MEMBRO\r\nexport async function createTeamMember(formData: FormData) {\r\n  try {\r\n    const name = formData.get(\"name\") as string\r\n    const role = formData.get(\"role\") as string\r\n    const category = formData.get(\"category\") as string\r\n    const bio = formData.get(\"bio\") as string\r\n    const instagram = formData.get(\"instagram\") as string\r\n    const email = formData.get(\"email\") as string\r\n    const order = parseInt(formData.get(\"order\") as string || \"0\")\r\n    \r\n    // SALVA NA PASTA \"team\"\r\n    const file = formData.get(\"image\") as File\r\n    const image = await saveFile(file, \"team\")\r\n\r\n    if (!name) return { error: \"Nome é obrigatório.\" }\r\n\r\n    await prisma.teamMember.create({\r\n      data: { name, role, category, bio, image, instagram, email, order }\r\n    })\r\n\r\n    revalidatePath(\"/admin/institution/team\")\r\n    revalidatePath(\"/instituicao/equipe\")\r\n    revalidatePath(\"/instituicao/diretoria\") \r\n    return { success: true }\r\n  } catch (error) {\r\n    console.error(\"Erro ao criar membro:\", error)\r\n    return { error: \"Erro ao salvar.\" }\r\n  }\r\n}\r\n\r\n// 2. ATUALIZAR MEMBRO\r\nexport async function updateTeamMember(formData: FormData) {\r\n  try {\r\n    const id = formData.get(\"id\") as string\r\n    if (!id) return { error: \"ID não encontrado.\" }\r\n\r\n    const name = formData.get(\"name\") as string\r\n    const role = formData.get(\"role\") as string\r\n    const category = formData.get(\"category\") as string\r\n    const bio = formData.get(\"bio\") as string\r\n    const instagram = formData.get(\"instagram\") as string\r\n    const email = formData.get(\"email\") as string\r\n    const order = parseInt(formData.get(\"order\") as string || \"0\")\r\n\r\n    const file = formData.get(\"image\") as File\r\n    let image = formData.get(\"existingImage\") as string\r\n    \r\n    if (file && file.size > 0) {\r\n        image = await saveFile(file, \"team\")\r\n    }\r\n\r\n    await prisma.teamMember.update({\r\n      where: { id },\r\n      data: { name, role, category, bio, image, instagram, email, order }\r\n    })\r\n\r\n    revalidatePath(\"/admin/institution/team\")\r\n    revalidatePath(\"/instituicao/equipe\")\r\n    revalidatePath(\"/instituicao/diretoria\")\r\n    return { success: true }\r\n  } catch (error) {\r\n    console.error(\"Erro ao atualizar membro:\", error)\r\n    return { error: \"Erro ao atualizar.\" }\r\n  }\r\n}\r\n\r\n// 3. EXCLUIR MEMBRO\r\nexport async function deleteTeamMember(formData: FormData) {\r\n  const id = formData.get(\"id\") as string\r\n  if (!id) return\r\n\r\n  try {\r\n    await prisma.teamMember.delete({ where: { id } })\r\n    revalidatePath(\"/admin/institution/team\")\r\n    revalidatePath(\"/instituicao/equipe\")\r\n    revalidatePath(\"/instituicao/diretoria\")\r\n  } catch (error) {\r\n    console.error(\"Erro ao excluir:\", error)\r\n  }\r\n}\r\n\r\n// 4. BUSCAR MEMBROS\r\nexport async function getTeamMembers(category?: string) {\r\n  try {\r\n    const where = category ? { category } : {};\r\n    const members = await prisma.teamMember.findMany({\r\n      where,\r\n      orderBy: { order: 'asc' }\r\n    })\r\n    return members\r\n  } catch (error) {\r\n    console.error(\"Erro ao buscar equipe:\", error)\r\n    return []\r\n  }\r\n}","export {updateTeamMember as '40a5f44924e44ddd17e17d920f36c235d18522fbd1'} from 'ACTIONS_MODULE0'\nexport {createTeamMember as '409aaad86672a127821d1c9a809d7a6feef569a2ae'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":"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"}