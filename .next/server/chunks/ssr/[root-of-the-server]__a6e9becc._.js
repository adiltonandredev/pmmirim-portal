module.exports=[24868,(a,b,c)=>{b.exports=a.x("fs/promises",()=>require("fs/promises"))},21526,a=>{"use strict";var b=a.i(24868),c=a.i(14747);async function d(a,e="general"){if(!a||"object"!=typeof a||!a.size)return"";try{let d=await a.arrayBuffer(),f=Buffer.from(d),g=a.name.replace(/[^a-zA-Z0-9.-]/g,"_"),h=`${Date.now()}-${g}`,i=(0,c.join)(process.cwd(),"public","uploads",e);await (0,b.mkdir)(i,{recursive:!0});let j=(0,c.join)(i,h);return await (0,b.writeFile)(j,f),`/uploads/${e}/${h}`}catch(a){return console.error(`Erro ao salvar arquivo em ${e}:`,a),""}}a.s(["saveFile",()=>d])},22734,(a,b,c)=>{b.exports=a.x("fs",()=>require("fs"))},71225,a=>{"use strict";var b=a.i(37936),c=a.i(66518),d=a.i(18558),e=a.i(24868),f=a.i(14747),g=a.i(22734),h=a.i(21526);function i(a){return"string"==typeof a?a:a.get("id")}async function j(a){try{let b=(0,f.join)(process.cwd(),"public",a);(0,g.existsSync)(b)&&await (0,e.unlink)(b)}catch(a){}}async function k(a){let b,e=a.get("id"),f=a.get("title"),g=a.get("description"),i=a.get("date"),j="true"===a.get("active"),k=a.get("coverImage");k&&k.size>0&&(b=await (0,h.saveFile)(k,"albums"));try{return e?await c.prisma.album.update({where:{id:e},data:{title:f,description:g,date:i?new Date(i):void 0,active:j,...b&&{coverImage:b}}}):await c.prisma.album.create({data:{title:f,description:g,date:i?new Date(i):new Date,active:j,coverImage:b||null}}),(0,d.revalidatePath)("/admin/galeria"),(0,d.revalidatePath)("/galeria"),{success:!0}}catch(a){return console.error("Erro saveAlbum:",a),{error:"Erro ao salvar álbum"}}}async function l(a){let b=i(a);if(b)try{let a=await c.prisma.album.findUnique({where:{id:b},include:{photos:!0}});if(a)for(let b of(a.coverImage&&j(a.coverImage),a.photos))j(b.url);return await c.prisma.album.delete({where:{id:b}}),(0,d.revalidatePath)("/admin/galeria"),{success:!0}}catch(a){return console.error("Erro deleteAlbum:",a),{error:"Erro ao deletar"}}}async function m(a){let b=a.get("albumId"),e=a.getAll("photos");if(!b)return{success:!1,error:"ID do álbum faltando"};let f=0;try{for(let a of e)if(a.size>0){let d=await (0,h.saveFile)(a,"albums");d&&(await c.prisma.photo.create({data:{albumId:b,url:d}}),f++)}return(0,d.revalidatePath)("/admin/galeria"),{success:!0,count:f}}catch(a){return console.error(a),{success:!1,error:"Erro ao enviar fotos"}}}async function n(a){let b=i(a);if(b)try{let a=await c.prisma.photo.findUnique({where:{id:b}});return a&&(j(a.url),await c.prisma.photo.delete({where:{id:b}})),(0,d.revalidatePath)("/admin/galeria"),{success:!0}}catch(a){return console.error("Erro deletePhoto:",a),{error:"Erro ao deletar foto"}}}async function o(a){let b=a.get("title"),d=a.get("coverImage"),e=b.toLowerCase().replace(/\s+/g,"_")+"_"+Date.now().toString().slice(-4),f=await (0,h.saveFile)(d,"gallery");return(await c.prisma.gallery.create({data:{title:b,slug:e,coverUrl:f}})).id}async function p(a,b){for(let d of b.getAll("images")){let b=await (0,h.saveFile)(d,"gallery");b&&await c.prisma.galleryImage.create({data:{galleryId:a,url:b}})}}async function q(a,b){let d=await c.prisma.galleryImage.findUnique({where:{id:a}});d&&(j(d.url),await c.prisma.galleryImage.delete({where:{id:a}}))}async function r(a){let b=a.get("id");await c.prisma.gallery.delete({where:{id:b}}),(0,d.revalidatePath)("/admin/gallery")}async function s(){return(await c.prisma.gallery.findMany({orderBy:{createdAt:"desc"},include:{_count:{select:{images:!0}}}})).map(a=>({...a,coverImage:a.coverUrl}))}async function t(a){return await c.prisma.gallery.findUnique({where:{id:a},include:{images:{orderBy:{id:"desc"}}}})}async function u(a){let b=await c.prisma.gallery.findUnique({where:{slug:a},include:{images:{orderBy:{id:"desc"}}}});return(b||(b=await c.prisma.gallery.findUnique({where:{id:a},include:{images:{orderBy:{id:"desc"}}}})),b)?{...b,coverImage:b.coverUrl,photos:b.images}:null}async function v(a){try{return await o(a),{success:!0}}catch(a){return{error:"Erro ao criar galeria"}}}async function w(a){let b=a.get("id"),e=a.get("title"),f=a.get("coverImage");if(!b)return{error:"ID faltando"};try{let a;return f&&f.size>0&&(a=await (0,h.saveFile)(f,"gallery")),await c.prisma.gallery.update({where:{id:b},data:{title:e,...a&&{coverUrl:a}}}),(0,d.revalidatePath)("/admin/gallery"),(0,d.revalidatePath)("/galeria"),{success:!0}}catch(a){return console.error("Erro updateGalleryItem:",a),{error:"Erro ao atualizar"}}}(0,a.i(13095).ensureServerEntryExports)([k,l,m,n,o,p,q,r,s,t,u,v,w]),(0,b.registerServerReference)(k,"40e8456f4ea1a767e9a35d40e3baaea4cc7deb0e67",null),(0,b.registerServerReference)(l,"40b2d6892f99fb883bfad957364019845df1372cb7",null),(0,b.registerServerReference)(m,"40527a420c416135fcf2c19b74ebd83dc256f83c20",null),(0,b.registerServerReference)(n,"40a3a895bf81f4105398e87695aa55c0fe645e563b",null),(0,b.registerServerReference)(o,"409d9d782e918820a3084048ae9202bfa8e11fdd0d",null),(0,b.registerServerReference)(p,"6058e216da9a57c2231bf86469453d67f2bb427292",null),(0,b.registerServerReference)(q,"604169078ce024eb5c29f8f3138d1ad921601090dc",null),(0,b.registerServerReference)(r,"4087b109c075546861243dbe1d963fc7aae70d8e20",null),(0,b.registerServerReference)(s,"0016e922c2cc295af527d2c2058d4a9dc9b53bb494",null),(0,b.registerServerReference)(t,"40e03474fb26d041df8f3c4ffa9639dcebf8ebcd15",null),(0,b.registerServerReference)(u,"40213924301bc838e2b93755f61fb891d35109485a",null),(0,b.registerServerReference)(v,"40c414d1cb35a183f1ab7e0a5c034adc6ac596818d",null),(0,b.registerServerReference)(w,"40b8093fe8abb8274004232c22eb97d3e148e2393c",null),a.s(["createGallery",()=>o,"createGalleryItem",()=>v,"deleteAlbum",()=>l,"deleteGallery",()=>r,"deletePhoto",()=>n,"deleteSingleImage",()=>q,"getAlbum",()=>u,"getAlbums",()=>s,"getGallery",()=>t,"saveAlbum",()=>k,"updateGalleryItem",()=>w,"uploadAlbumPhotos",()=>m,"uploadGalleryImages",()=>p])},36474,a=>{"use strict";var b=a.i(71225);a.s([],42788),a.i(42788),a.s(["0016e922c2cc295af527d2c2058d4a9dc9b53bb494",()=>b.getAlbums,"40213924301bc838e2b93755f61fb891d35109485a",()=>b.getAlbum,"40527a420c416135fcf2c19b74ebd83dc256f83c20",()=>b.uploadAlbumPhotos,"4087b109c075546861243dbe1d963fc7aae70d8e20",()=>b.deleteGallery,"409d9d782e918820a3084048ae9202bfa8e11fdd0d",()=>b.createGallery,"40a3a895bf81f4105398e87695aa55c0fe645e563b",()=>b.deletePhoto,"40b2d6892f99fb883bfad957364019845df1372cb7",()=>b.deleteAlbum,"40b8093fe8abb8274004232c22eb97d3e148e2393c",()=>b.updateGalleryItem,"40c414d1cb35a183f1ab7e0a5c034adc6ac596818d",()=>b.createGalleryItem,"40e03474fb26d041df8f3c4ffa9639dcebf8ebcd15",()=>b.getGallery,"40e8456f4ea1a767e9a35d40e3baaea4cc7deb0e67",()=>b.saveAlbum,"604169078ce024eb5c29f8f3138d1ad921601090dc",()=>b.deleteSingleImage,"6058e216da9a57c2231bf86469453d67f2bb427292",()=>b.uploadGalleryImages],36474)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__a6e9becc._.js.map