{"version":3,"sources":["../../../../src/app/actions/upload.ts","../../../../src/app/actions/institution.ts","../../../../.next-internal/server/app/admin/institution/history/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["'use server'\r\n\r\nimport { writeFile, mkdir } from 'fs/promises'\r\nimport { join } from 'path'\r\n\r\nexport async function uploadImage(formData: FormData) {\r\n  const file = formData.get('file') as File\r\n  \r\n  if (!file) {\r\n    throw new Error('Nenhum arquivo enviado')\r\n  }\r\n\r\n  const bytes = await file.arrayBuffer()\r\n  const buffer = Buffer.from(bytes)\r\n\r\n  // Cria um nome único para o arquivo para não substituir outros\r\n  const filename = `${Date.now()}-${file.name.replace(/\\s/g, '-')}`\r\n  \r\n  // Caminho onde será salvo (dentro de public/uploads)\r\n  const uploadDir = join(process.cwd(), 'public', 'uploads')\r\n  \r\n  // Garante que a pasta existe\r\n  try {\r\n    await mkdir(uploadDir, { recursive: true })\r\n  } catch (e) {\r\n    // Ignora erro se a pasta já existir\r\n  }\r\n\r\n  const path = join(uploadDir, filename)\r\n\r\n  // Salva o arquivo no disco\r\n  await writeFile(path, buffer)\r\n\r\n  // Retorna a URL pública para o editor usar\r\n  return `/uploads/${filename}`\r\n}","'use server'\r\n\r\nimport { prisma } from \"@/lib/prisma\"\r\nimport { revalidatePath } from \"next/cache\"\r\n\r\nexport async function updateInstitutionHistory(formData: FormData) {\r\n  const title = formData.get(\"title\") as string\r\n  const content = formData.get(\"content\") as string\r\n  const mission = formData.get(\"mission\") as string\r\n  const vision = formData.get(\"vision\") as string\r\n  const values = formData.get(\"values\") as string\r\n  // 1. ADICIONADO AQUI\r\n  const principles = formData.get(\"principles\") as string \r\n  \r\n  const existing = await prisma.institutionHistory.findFirst()\r\n\r\n  if (existing) {\r\n    await prisma.institutionHistory.update({\r\n      where: { id: existing.id },\r\n      data: {\r\n        title,\r\n        content,\r\n        mission,\r\n        vision,\r\n        values,\r\n        principles, // 2. ADICIONADO AQUI\r\n      },\r\n    })\r\n  } else {\r\n    await prisma.institutionHistory.create({\r\n      data: {\r\n        title: title || \"História da PMMirim\",\r\n        content: content || \"\",\r\n        mission,\r\n        vision,\r\n        values,\r\n        principles, // 3. ADICIONADO AQUI\r\n      },\r\n    })\r\n  }\r\n\r\n  revalidatePath(\"/instituicao/historia\")\r\n  revalidatePath(\"/admin/institution/history\")\r\n  \r\n  return { success: true }\r\n}","export {updateInstitutionHistory as '408c6ac672c1556d44826396207e5c2aecc3e0b9d4'} from 'ACTIONS_MODULE0'\nexport {uploadImage as '401628db911d95f41b15dc4a76335400ed4d4ce6ea'} from 'ACTIONS_MODULE1'\n"],"names":[],"mappings":"iIAEA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAEO,eAAe,EAAY,CAAkB,EAClD,IAAM,EAAO,EAAS,GAAG,CAAC,QAE1B,GAAI,CAAC,EACH,IADS,EACH,AAAI,MAAM,0BAGlB,IAAM,EAAQ,MAAM,EAAK,WAAW,GAC9B,EAAS,OAAO,IAAI,CAAC,GAGrB,EAAW,CAAA,EAAG,KAAK,GAAG,GAAG,CAAC,EAAE,EAAK,IAAI,CAAC,OAAO,CAAC,MAAO,KAAA,CAAM,CAG3D,EAAY,CAAA,EAAA,EAAA,IAAA,AAAI,EAAC,QAAQ,GAAG,GAAI,SAAU,WAGhD,GAAI,CACF,MAAM,CAAA,EAAA,EAAA,KAAA,AAAK,EAAC,EAAW,CAAE,UAAW,EAAK,EAC3C,CAAE,MAAO,EAAG,CAEZ,CAEA,IAAM,EAAO,CAAA,EAAA,EAAA,IAAA,AAAI,EAAC,EAAW,GAM7B,OAHA,MAAM,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,EAAM,GAGf,CAAC,SAAS,EAAE,EAAA,CAAU,AAC/B,0CA9BsB,IAAA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,0ECHtB,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAEO,eAAe,EAAyB,CAAkB,EAC/D,IAAM,EAAQ,EAAS,GAAG,CAAC,SACrB,EAAU,EAAS,GAAG,CAAC,WACvB,EAAU,EAAS,GAAG,CAAC,WACvB,EAAS,EAAS,GAAG,CAAC,UACtB,EAAS,EAAS,GAAG,CAAC,UAEtB,EAAa,EAAS,GAAG,CAAC,cAE1B,EAAW,MAAM,EAAA,MAAM,CAAC,kBAAkB,CAAC,SAAS,GA8B1D,OA5BI,EACF,MAAM,EADM,AACN,MAAM,CAAC,kBAAkB,CAAC,MAAM,CAAC,CACrC,MAAO,CAAE,GAAI,EAAS,EAAE,AAAC,EACzB,KAAM,OACJ,UACA,UACA,SACA,SACA,aACA,CACF,CACF,GAEA,MAAM,EAAA,MAAM,CAAC,kBAAkB,CAAC,MAAM,CAAC,CACrC,KAAM,CACJ,MAAO,GAAS,sBAChB,QAAS,GAAW,WACpB,SACA,SACA,aACA,CACF,CACF,GAGF,CAAA,EAAA,EAAA,cAAA,AAAc,EAAC,yBACf,CAAA,EAAA,EAAA,cAAA,AAAc,EAAC,8BAER,CAAE,QAAS,EAAK,CACzB,0CAxCsB,IAAA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,sECLtB,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA"}