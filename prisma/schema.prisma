generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  EDITOR
}

model User {
  id               String     @id @default(cuid())
  name             String?
  email            String     @unique
  password         String
  role             Role       @default(EDITOR)
  createdAt        DateTime   @default(now())
  resetToken       String?
  resetTokenExpiry DateTime?
  logs             AuditLog[] 
}

model AuditLog {
  id        String   @id @default(cuid())
  action    String   
  resource  String   
  details   String?  
  createdAt DateTime @default(now())
  
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
}

model SiteSettings {
  id             String   @id @default(cuid())
  siteName       String   @default("Polícia Militar Mirim")
  cnpj           String?  
  legalName      String?  
  description    String?  @db.Text

  // Contato
  contactPhone   String?
  contactEmail   String?
  businessHours  String?  
  address        String?
  
  // Visual e Social
  logoUrl        String?
  instagramUrl   String?
  facebookUrl    String?
  youtubeUrl     String?  

  // --- NOVOS CAMPOS PARA A PÁGINA PROJETOS ---
  impactedYouth  String   @default("100+") 
  yearsOfHistory String   @default("20")   
  
  updatedAt      DateTime @updatedAt
}

enum BannerType {
  HOME          
  PARTNER       
  SPONSOR       
}

model Banner {
  id          String      @id @default(cuid())
  title       String?
  description String?
  imageUrl    String      @db.LongText
  link        String?
  order       Int         @default(0)
  active      Boolean     @default(true)
  
  type        BannerType  @default(HOME)

  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
}

model Post {
  id          String    @id @default(cuid())
  title       String
  slug        String    @unique
  content     String    @db.Text
  summary     String?   @db.Text
  coverImage  String?   @db.LongText
  published   Boolean   @default(false)
  type        PostType  @default(NEWS)
  featured    Boolean   @default(false)

  eventDate   DateTime?
  location    String?

  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  comments    Comment[]
}

model Comment {
  id        String   @id @default(cuid())
  author    String   
  content   String   @db.Text
  
  postId    String
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
}

enum PostType {
  NEWS
  EVENT
  ACTIVITY
  PROJECT
}

model Partner {
  id      String   @id @default(cuid())
  name    String
  logoUrl String   @db.Text
  website String?  @db.Text
  active  Boolean  @default(true)
}

model ContactMessage {
  id        String   @id @default(cuid())
  name      String
  email     String
  subject   String?
  message   String   @db.Text
  read      Boolean  @default(false)
  createdAt DateTime @default(now())
}

model InstitutionHistory {
  id          String   @id @default(cuid())
  title       String
  content     String   @db.LongText
  mission     String?  @db.Text
  vision      String?  @db.Text
  values      String?  @db.Text
  principles  String?  @db.Text
  updatedAt   DateTime @updatedAt
}

model BoardMember {
  id        String   @id @default(cuid())
  name      String
  position  String
  bio       String?  @db.Text
  photoUrl  String?  @db.Text
  email     String?
  phone     String?
  order     Int      @default(0)
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
}

model Course {
  id          String   @id @default(cuid())
  title       String
  slug        String   @unique
  
  description String?  @db.Text 
  content     String?  @db.Text 
  
  coverImage  String?  @db.LongText 

  duration    String?
  targetAge   String?
  
  sponsorName String?
  sponsorLogo String?  @db.Text
  active      Boolean  @default(true)
  featured    Boolean  @default(false)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model FeaturedStudent {
  id          String   @id @default(cuid())
  studentName String
  photoUrl    String?  @db.LongText
  achievement String   @db.Text
  description String?  @db.Text
  class       String?
  month       Int
  year        Int
  active      Boolean  @default(true)
  createdAt   DateTime @default(now())
}

model InstagramSettings {
  id          String   @id @default(cuid())
  accessToken String?  @db.Text
  username    String?
  enabled     Boolean  @default(false)
  updatedAt   DateTime @updatedAt
}

model Event {
  id          String   @id @default(cuid())
  title       String
  description String?  @db.Text
  date        DateTime
  location    String?
  bannerUrl   String?  @db.LongText
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// REMOVI O STUDENT ANTIGO QUE ESTAVA AQUI!

model Birthday {
  id        String   @id @default(uuid())
  name      String
  role      String?
  date      DateTime
  photoUrl  String?  @db.LongText  
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model TeamMember {
  id        String   @id @default(cuid())
  name      String
  role      String
  category  String   @default("Geral")
  image     String?  @db.LongText
  bio       String?
  
  instagram String?  
  email     String?  

  order     Int      @default(0)
  active    Boolean  @default(true)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Album {
  id          String   @id @default(cuid())
  title       String
  date        DateTime 
  coverImage  String?  
  description String?
  active      Boolean  @default(true)
  
  photos      Photo[]  
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Photo {
  id        String   @id @default(cuid())
  url       String   
  albumId   String
  album     Album    @relation(fields: [albumId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
}

model Gallery {
  id        String   @id @default(cuid())
  title     String
  slug      String   @unique
  coverUrl  String?
  createdAt DateTime @default(now())
  
  images    GalleryImage[] 

  @@map("galleries")
}

model GalleryImage {
  id        String   @id @default(cuid())
  url       String
  galleryId String
  gallery   Gallery  @relation(fields: [galleryId], references: [id], onDelete: Cascade)

  @@map("gallery_images")
}

model OrganizationalStructure {
  id          String   @id @default(cuid())
  title       String
  description String?  @db.Text
  
  content     String?  @db.LongText
  chartImage  String?  @db.LongText

  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// --- ÁREA DO ALUNO (MONITORAMENTO ESCOLAR) ---

model Student {
  id            String    @id @default(cuid())
  name          String
  matricula     String    @unique // Login do aluno
  password      String    // Senha de acesso
  
  // Dados Pessoais
  birthDate     DateTime?
  cpf           String?
  phone         String?   // Contato dos pais
  address       String?
  photoUrl      String?   // Foto fardado (opcional)

  // Dados da Escola Regular (Onde ele estuda de verdade)
  schoolName    String?   // Ex: "Escola Carlos Drummond"
  schoolGrade   String?   // Ex: "7º Ano B"
  shift         String?   // Ex: "Matutino" / "Vespertino"

  active        Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  reports       SchoolReport[] // Os boletins que ele traz
  attendances   Attendance[]   // Presença nas atividades da Polícia Mirim
}

// O Boletim que ele traz da escola (Ex: 1º Trimestre)
model SchoolReport {
  id            String    @id @default(cuid())
  term          String    // Ex: "1º Trimestre", "2º Bimestre"
  year          Int       // Ex: 2024
  
  // O sistema vai calcular e salvar isso aqui
  average       Float     // A média final (Ex: 8.5)
  status        String    // "VERDE", "AMARELO", "VERMELHO"
  
  // Detalhe das matérias (Como na imagem do Excel que você mandou)
  grades        SubjectGrade[]

  student       Student   @relation(fields: [studentId], references: [id], onDelete: Cascade)
  studentId     String
  
  createdAt     DateTime  @default(now())
}

// Nota de cada matéria dentro do boletim (Opcional, mas bom para gerar o gráfico)
model SubjectGrade {
  id            String       @id @default(cuid())
  subject       String       // Ex: "Matemática", "Português", "Biologia"
  grade         Float        // Ex: 9.5
  
  report        SchoolReport @relation(fields: [reportId], references: [id], onDelete: Cascade)
  reportId      String
}

// Presença nos treinos/encontros da Polícia Mirim
model Attendance {
  id            String    @id @default(cuid())
  date          DateTime
  status        String    // "PRESENTE", "FALTA", "JUSTIFICADO"
  observation   String?   // Ex: "Chegou atrasado", "Sem uniforme"
  
  student       Student   @relation(fields: [studentId], references: [id], onDelete: Cascade)
  studentId     String
}